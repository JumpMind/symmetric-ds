<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:util="http://www.springframework.org/schema/util"
  xsi:schemaLocation="    
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd"
  default-lazy-init="true">

  <util:map id="incomingBatchServiceSql">
    <entry key="selectIncomingBatchPrefixSql">
      <value>
        select batch_id, node_id, channel_id, status, network_millis, filter_millis, database_millis, failed_row_number, byte_count, 
        statement_count, fallback_insert_count, fallback_update_count, missing_delete_count, skip_count, sql_state, sql_code, sql_message,
        last_update_hostname, last_update_time, create_time, error_flag from $[sym.sync.table.prefix]_incoming_batch 
      </value>
    </entry>  
    <entry key="selectCreateTimePrefixSql">
      <value>
        select create_time from $[sym.sync.table.prefix]_incoming_batch 
      </value>
    </entry>      
    <entry key="findIncomingBatchSql">
      <value>
        where batch_id = ? and node_id = ?
      </value>
    </entry>
    <entry key="listIncomingBatchesSql">
      <value>
        where node_id in (:NODES) and channel_id in (:CHANNELS) and status in (:STATUSES) and create_time &lt;= :CREATE_TIME order by create_time desc
      </value>
    </entry>
    <entry key="listIncomingBatchesInErrorSql">
      <value>
        where node_id in (:NODES) and channel_id in (:CHANNELS) and error_flag=1 and create_time &lt;= :CREATE_TIME order by create_time desc
      </value>
    </entry>    
    <entry key="findIncomingBatchErrorsSql">
      <value>
        where status = 'ER' order by batch_id
      </value>
    </entry>    
    <entry key="countIncomingBatchesErrorsSql">
      <value>
        select count(*) from $[sym.sync.table.prefix]_incoming_batch where error_flag=1
      </value>
    </entry>    
    <entry key="insertIncomingBatchSql">
      <value>
        insert into $[sym.sync.table.prefix]_incoming_batch (batch_id, node_id, channel_id, status, network_millis, filter_millis, database_millis, failed_row_number, byte_count, 
        statement_count, fallback_insert_count, fallback_update_count, missing_delete_count, skip_count, sql_state, sql_code, sql_message,
        last_update_hostname, last_update_time, create_time)
        values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, current_timestamp)
      </value>
    </entry>
    <entry key="updateIncomingBatchSql">
      <value>
        update $[sym.sync.table.prefix]_incoming_batch set status = ?, error_flag=?, network_millis = ?, filter_millis = ?, database_millis = ?, failed_row_number = ?, byte_count = ?, 
        statement_count = ?, fallback_insert_count = ?, fallback_update_count = ?, missing_delete_count = ?, skip_count = ?,  sql_state = ?, sql_code = ?, sql_message = ?,
        last_update_hostname = ?, last_update_time = ? where batch_id = ? and node_id = ?
      </value>
    </entry>
  </util:map>

</beans>