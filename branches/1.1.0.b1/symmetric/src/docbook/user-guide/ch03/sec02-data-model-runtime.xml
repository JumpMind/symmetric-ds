<?xml version="1.0" encoding="UTF-8"?>
<section version="5.0" xml:id="sec02-data-model-runtime" xmlns="http://docbook.org/ns/docbook"
    xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:svg="http://www.w3.org/2000/svg" xmlns:ns="http://docbook.org/ns/docbook"
    xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:html="http://www.w3.org/1999/xhtml">
    <title>Runtime Data Model</title>
    <para>
        At runtime, the configuration is used to capture data changes and route them to nodes. The
        data changes are placed together in a single unit called a batch that can be loaded by
        another node. Outgoing batches are delivered to nodes and acknowledged. Incoming batches are
        received and loaded. History is recorded for batch status changes and statistics.
    </para>
    <para>
        <figure>
            <title>Runtime Data Model</title>
            <mediaobject>
                <imageobject>
                    <imagedata fileref="images/data-model-runtime.gif" format="GIF" />
                </imageobject>
            </mediaobject>
        </figure>
    </para>
    <section>
        <title>Data</title>
        <para>The captured data change that occurred to a row in the database.</para>
        <para>
            <table>
                <title>Data</title>
                <tgroup cols="6">
                    <colspec colwidth="115px" />
                    <colspec colwidth="65px" />
                    <colspec colwidth="25px" />
                    <colspec colwidth="25px" />
                    <colspec colwidth="40px" />
                    <colspec colwidth="250px" />
                    <thead>
                        <row>
                            <entry>Column Name</entry>
                            <entry>Type</entry>
                            <entry>Null</entry>
                            <entry>Key</entry>
                            <entry>Default</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>data_id</entry>
                            <entry>integer</entry>
                            <entry>N</entry>
                            <entry>PK</entry>
                            <entry></entry>
                            <entry>Unique identifier for a data</entry>
                        </row>
                        <row>
                            <entry>channel_id</entry>
                            <entry>varchar(50)</entry>
                            <entry>N</entry>
                            <entry>FK</entry>
                            <entry></entry>
                            <entry>The channel that this data belongs to, such as "prices"</entry>
                        </row>
                        <row>
                            <entry>table_name</entry>
                            <entry>varchar(50)</entry>
                            <entry>N</entry>
                            <entry></entry>
                            <entry></entry>
                            <entry>
                                The name of the table in which a change occurred that this entry
                                records.
                            </entry>
                        </row>
                        <row>
                            <entry>event_type</entry>
                            <entry>char(1)</entry>
                            <entry>Y</entry>
                            <entry></entry>
                            <entry></entry>
                            <entry>
                                The type of event captured by this entry. For triggers, this is the
                                change that occurred, which is "I" for insert, "U" for update, or
                                "D" for delete. Other events include: "R" for reloading the entire
                                table (or subset of the table) to the node; "S" for running dynamic
                                SQL at the node, which is used for adhoc administration.
                            </entry>
                        </row>
                        <row>
                            <entry>row_data</entry>
                            <entry>longvarchar</entry>
                            <entry>Y</entry>
                            <entry></entry>
                            <entry></entry>
                            <entry>
                                The captured data change from the synchronized table. The column
                                values are stored in comma-separated values (CSV) format.
                            </entry>
                        </row>
                        <row>
                            <entry>pk_data</entry>
                            <entry>longvarchar</entry>
                            <entry>Y</entry>
                            <entry></entry>
                            <entry></entry>
                            <entry>
                                The primary key values of the captured data change from the
                                synchronized table. This data is captured for updates and deletes.
                                The primary key values are stored in comma-separated values (CSV)
                                format.
                            </entry>
                        </row>
                        <row>
                            <entry>trigger_hist_id</entry>
                            <entry>integer</entry>
                            <entry>N</entry>
                            <entry>FK</entry>
                            <entry></entry>
                            <entry>
                                The foreign key to the Trigger Hist entry that contains the primary
                                key and column names for the table being synchronized.
                            </entry>
                        </row>
                        <row>
                            <entry>transaction_id</entry>
                            <entry>varchar(1000)</entry>
                            <entry>Y</entry>
                            <entry></entry>
                            <entry></entry>
                            <entry>
                                An optional transaction identifier that links multiple data changes
                                together as the same transaction.
                            </entry>
                        </row>
                        <row>
                            <entry>create_time</entry>
                            <entry>timestamp</entry>
                            <entry>Y</entry>
                            <entry></entry>
                            <entry></entry>
                            <entry>The timestamp when the data change was captured.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>
    </section>
    <section>
        <title>Data Event</title>
        <para>
            The Data Event represents routing of a Data to a Node within the unit of a Batch.
        </para>
        <para>
            <table>
                <title>Data Event</title>
                <tgroup cols="6">
                    <colspec colwidth="115px" />
                    <colspec colwidth="65px" />
                    <colspec colwidth="25px" />
                    <colspec colwidth="25px" />
                    <colspec colwidth="40px" />
                    <colspec colwidth="250px" />
                    <thead>
                        <row>
                            <entry>Column Name</entry>
                            <entry>Type</entry>
                            <entry>Null</entry>
                            <entry>Key</entry>
                            <entry>Default</entry>
                            <entry>Description</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>data_id</entry>
                            <entry>integer</entry>
                            <entry>N</entry>
                            <entry>PK FK</entry>
                            <entry></entry>
                            <entry>The Data that will be routed.</entry>
                        </row>
                        <row>
                            <entry>node_id</entry>
                            <entry>varchar(50)</entry>
                            <entry>N</entry>
                            <entry>PK FK</entry>
                            <entry></entry>
                            <entry>The Node that will receive the Data.</entry>
                        </row>
                        <row>
                            <entry>batch_id</entry>
                            <entry>integer</entry>
                            <entry>Y</entry>
                            <entry>FK</entry>
                            <entry></entry>
                            <entry>
                                A unique identifier for a batch that will be a unit of
                                delivery for multiple Data Events.
                            </entry>
                        </row>
                        <row>
                            <entry>batched</entry>
                            <entry>char(1)</entry>
                            <entry>N</entry>
                            <entry></entry>
                            <entry>0</entry>
                            <entry>
                                Whether or not this Data Event is prepared for a batch.
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>
    </section>
</section>
