<?xml version="1.0"?>
<!DOCTYPE database SYSTEM "http://db.apache.org/torque/dtd/database.dtd">

<database name="symmetric">

    <table name="channel">
        <column name="channel_id" type="VARCHAR" size="50" primaryKey="true" />
        <column name="processing_order" type="INTEGER" required="true" default="1" />
        <column name="max_batch_size" type="INTEGER" required="true" default="1000" />
        <column name="enabled" type="BOOLEANINT" size="1" required="true" default="1" />
        <column name="description" type="VARCHAR" size="1000" />
    </table>

    <table name="data">
        <column name="data_id" type="INTEGER" required="true" primaryKey="true"
            autoIncrement="true" />
        <column name="channel_id" type="VARCHAR" size="50" />
        <column name="table_name" type="VARCHAR" size="50" required="true" />
        <column name="event_type" type="CHAR" size="1" />
        <column name="row_data" type="LONGVARCHAR" />
        <column name="pk_data" type="LONGVARCHAR" />
        <column name="trigger_hist_id" type="INTEGER" required="true" />
        <column name="transaction_id" type="VARCHAR" size="1000" />
        <column name="create_time" type="TIMESTAMP" />
        <foreign-key name="fk_d_channel_id" foreignTable="channel">
            <reference local="channel_id" foreign="channel_id" />
        </foreign-key>
        <foreign-key name="fk_d_ts_audit_id" foreignTable="trigger_hist">
            <reference local="trigger_hist_id" foreign="trigger_hist_id" />
        </foreign-key>
    </table>

    <table name="event_status">
        <column name="event_status_id" type="INTEGER" primaryKey="true" />
        <column name="description" type="VARCHAR" size="50" />
    </table>

    <table name="outgoing_batch">
        <column name="batch_id" type="INTEGER" required="true" primaryKey="true"
            autoIncrement="true" />
        <column name="node_id" type="VARCHAR" size="50" required="false" primaryKey="false" />
        <column name="channel_id" type="VARCHAR" size="50" />
        <column name="batch_type" type="CHAR" size="2" required="true" default="EV" />
        <column name="status" type="CHAR" size="2" />
        <column name="create_time" type="TIMESTAMP" />
    </table>

    <table name="outgoing_batch_hist">
        <column name="history_id" type="INTEGER" required="true" primaryKey="true"
            autoIncrement="true" />
        <column name="batch_id" type="INTEGER" required="true" />
        <column name="status" type="CHAR" size="2" />
        <column name="data_event_count" type="INTEGER" />
        <column name="event_time" type="TIMESTAMP" />
        <column name="failed_data_id" type="INTEGER" />
    </table>

    <table name="data_event">
        <column name="data_id" type="INTEGER" required="true" primaryKey="true" />
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <column name="batch_id" type="INTEGER" />
        <foreign-key name="fk_de_data_id" foreignTable="data">
            <reference local="data_id" foreign="data_id" />
        </foreign-key>
        <foreign-key name="fk_de_node_id" foreignTable="node">
            <reference local="node_id" foreign="node_id" />
        </foreign-key>
        <foreign-key name="fk_de_batch_id" foreignTable="outgoing_batch">
            <reference local="batch_id" foreign="batch_id" />
        </foreign-key>
    </table>

    <table name="node_group">
        <column name="node_group_id" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <column name="description" type="VARCHAR" size="2000" />
    </table>

    <table name="node_group_link">
        <column name="source_node_group_id" type="VARCHAR" size="50" required="true"
            primaryKey="true" />
        <column name="target_node_group_id" type="VARCHAR" size="50" required="true"
            primaryKey="true" />
        <column name="data_event_action" type="CHAR" size="1" default="U" required="true" />
        <foreign-key name="fk_dt_node_group_id" foreignTable="node_group">
            <reference local="source_node_group_id" foreign="node_group_id" />
        </foreign-key>
        <foreign-key name="fk_dt_tgt_node_group_id" foreignTable="node_group">
            <reference local="target_node_group_id" foreign="node_group_id" />
        </foreign-key>
    </table>

    <table name="node">
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <column name="node_group_id" type="VARCHAR" size="50" required="true" />
        <column name="external_id" type="VARCHAR" size="50" required="true" />
        <column name="sync_enabled" type="BOOLEANINT" size="1" default="0" />
        <column name="sync_url" type="VARCHAR" size="2000" />
        <column name="schema_version" type="VARCHAR" size="50" />
        <column name="symmetric_version" type="VARCHAR" size="50" />
        <column name="database_type" type="VARCHAR" size="50" />
        <column name="database_version" type="VARCHAR" size="50" />
        <column name="heartbeat_time" type="TIMESTAMP" />
        <foreign-key name="fk_c_node_group_id" foreignTable="node_group">
            <reference local="node_group_id" foreign="node_group_id" />
        </foreign-key>
    </table>
    
    <table name="node_channel_ctl">
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <column name="channel_id" type="VARCHAR" size="50" primaryKey="true" />
        <column name="suspend_enabled" type="BOOLEANINT" size="1" default="0" />
        <column name="ignore_enabled" type="BOOLEANINT" size="1" default="0" />
        <foreign-key name="fk_ncc_node_id" foreignTable="node">
            <reference local="node_id" foreign="node_id" />
        </foreign-key>
        <foreign-key name="fk_ncc_channel_id" foreignTable="channel">
            <reference local="channel_id" foreign="channel_id" />
        </foreign-key>        
    </table>    

    <table name="node_security">
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <column name="password" type="VARCHAR" size="50" required="true" />
        <column name="registration_enabled" type="BOOLEANINT" size="1" default="0" />
        <column name="registration_time" type="TIMESTAMP" />
        <foreign-key name="fk_cs_node_id" foreignTable="node">
            <reference local="node_id" foreign="node_id" />
        </foreign-key>
    </table>

    <table name="node_identity">
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <foreign-key name="fk_ci_node_id" foreignTable="node">
            <reference local="node_id" foreign="node_id" />
        </foreign-key>
    </table>

    <table name="trigger">
        <column name="trigger_id" type="INTEGER" required="true" primaryKey="true"
            autoIncrement="true" />
        <column name="source_schema_name" type="VARCHAR" size="50" />
        <column name="source_table_name" type="VARCHAR" size="50" required="true" />        
        <column name="target_schema_name" type="VARCHAR" size="50" />
        <column name="target_table_name" type="VARCHAR" size="50" />        
        <column name="source_node_group_id" type="VARCHAR" size="50" required="true" />
        <column name="target_node_group_id" type="VARCHAR" size="50" required="true" />
        <column name="channel_id" type="VARCHAR" size="50" required="true" />
        <column name="sync_on_update" type="BOOLEANINT" size="1" required="true" default="1" />
        <column name="sync_on_insert" type="BOOLEANINT" size="1" required="true" default="1" />
        <column name="sync_on_delete" type="BOOLEANINT" size="1" required="true" default="1" />
        <column name="name_for_update_trigger" type="VARCHAR" size="30" />
        <column name="name_for_insert_trigger" type="VARCHAR" size="30" />
        <column name="name_for_delete_trigger" type="VARCHAR" size="30" />
        <column name="sync_on_update_condition" type="VARCHAR" size="1000" />
        <column name="sync_on_insert_condition" type="VARCHAR" size="1000" />
        <column name="sync_on_delete_condition" type="VARCHAR" size="1000" />
        <column name="initial_load_select" type="VARCHAR" size="1000" />
        <column name="node_select" type="VARCHAR" size="1000" />
        <column name="tx_id_expression" type="VARCHAR" size="1000" />
        <column name="excluded_column_names" type="VARCHAR" size="1000" />
        <column name="initial_load_order" type="INTEGER" required="true" default="1" />
        <column name="create_time" type="TIMESTAMP" required="true" />
        <column name="inactive_time" type="TIMESTAMP" />
        <column name="last_updated_by" type="VARCHAR" size="50" />
        <column name="last_updated_time" type="TIMESTAMP" required="true" />
        <foreign-key name="fk_tsc_channel_id" foreignTable="channel">
            <reference local="channel_id" foreign="channel_id" />
        </foreign-key>
        <foreign-key name="fk_tsc_node_group_id" foreignTable="node_group_link">
            <reference local="source_node_group_id" foreign="source_node_group_id" />
            <reference local="target_node_group_id" foreign="target_node_group_id" />
        </foreign-key>
    </table>

    <table name="trigger_hist">
        <column name="trigger_hist_id" type="INTEGER" required="true" primaryKey="true"
            autoIncrement="true" />
        <column name="trigger_id" type="INTEGER" required="true" />
        <column name="source_table_name" type="VARCHAR" default="" size="50" required="true" />
        <column name="source_schema_name" type="VARCHAR" size="50" />
        <column name="name_for_update_trigger" type="VARCHAR" size="30" required="true" />
        <column name="name_for_insert_trigger" type="VARCHAR" size="30" required="true" />
        <column name="name_for_delete_trigger" type="VARCHAR" size="30" required="true" />
        <column name="table_hash" type="BIGINT" required="true" />
        <column name="column_names" type="LONGVARCHAR" required="true" />
        <column name="pk_column_names" type="LONGVARCHAR" required="true" />
        <column name="last_trigger_build_reason" size="1" type="CHAR" required="true" />
        <column name="create_time" type="TIMESTAMP" required="true" />
        <column name="inactive_time" type="TIMESTAMP" />
        <foreign-key name="fk_th_trigger_id" foreignTable="trigger">
            <reference local="trigger_id" foreign="trigger_id" />
        </foreign-key>
    </table>

    <table name="global_parameter">
        <column name="node_group_id" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <column name="param_key" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <column name="param_order" type="INTEGER" required="true" default="1" primaryKey="true" />
        <column name="param_type" type="INTEGER" required="true" />
        <column name="string_value" type="VARCHAR" size="200" />
        <column name="boolean_value" type="BOOLEANINT" size="1" default="0" />
        <column name="decimal_value" type="DECIMAL" />
        <column name="int_value" type="INTEGER" />
    </table>

    <table name="incoming_batch">
        <column name="batch_id" type="INTEGER" size="50" required="true" primaryKey="true" />
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true" />
        <column name="status" type="CHAR" size="2" />
        <column name="create_time" type="TIMESTAMP" />
    </table>

    <table name="incoming_batch_hist">
        <column name="batch_id" type="INTEGER" size="50" />
        <column name="node_id" type="VARCHAR" size="50" />
        <column name="status" type="CHAR" size="2" />
        <column name="start_time" type="TIMESTAMP" />
        <column name="end_time" type="TIMESTAMP" />
        <column name="host_name" type="VARCHAR" size="50" />
        <column name="failed_row_number" type="INTEGER" />
        <column name="statement_count" type="INTEGER" />
        <column name="fallback_insert_count" type="INTEGER" />
        <column name="fallback_update_count" type="INTEGER" />
        <column name="missing_delete_count" type="INTEGER" />
        <index name="idx_incoming_batch_hist">
            <index-column name="batch_id" />
            <index-column name="node_id" />
        </index>
    </table>

</database>