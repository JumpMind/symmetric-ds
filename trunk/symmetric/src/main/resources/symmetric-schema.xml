<?xml version="1.0"?>
<!DOCTYPE database SYSTEM "http://db.apache.org/torque/dtd/database.dtd">

<database name="symmetric">

    <table name="parameter" description="Provides a way to manage most SymmetricDS settings in the database.">
        <column name="external_id" type="VARCHAR" size="50" required="true" primaryKey="true" description="Target the parameter at a specific external id. To target all nodes, use the value of 'ALL.'" />
        <column name="node_group_id" type="VARCHAR" size="50" required="true" primaryKey="true"  description="Target the parameter at a specific node group id. To target all groups, use the value of 'ALL.'"/>
        <column name="param_key" type="VARCHAR" size="100" required="true" primaryKey="true" description="The name of the parameter."/>
        <column name="param_value" type="VARCHAR" size="1000" description="The value of the parameter." />
    </table>

    <table name="lock" description="Contains semaphores that are set when processes run, so that only one server can run a process at a time.  Enable this feature by using the cluster.lock.during.xxxx parameters.">
        <column name="lock_id" type="VARCHAR" size="50" required="true" primaryKey="true" description="An id for the process that is running.  Many times this will be a value of 'common.'  It can also be a specfic node_id."/>
        <column name="lock_action" type="VARCHAR" size="50" required="true" primaryKey="true" description="The process that needs a lock."/>
        <column name="locking_server_id" type="VARCHAR" size="100" description="The name of the server that currently has a lock.  This is typically a host name, but it can be overridden using the -Druntime.symmetric.cluster.server.id=name System property."/>
        <column name="lock_time" type="TIMESTAMP" description="The time a lock is aquired.  Use the cluster.lock.timeout.ms to specify a lock timeout period." />
    </table>

    <table name="channel" description="This table represents a category of data that can be synchronized independently of other channels. Channels allow control over the type of data flowing and prevents one type of synchronization from contending with another.">
        <column name="channel_id" type="VARCHAR" size="20" required="true" primaryKey="true" description="A unique identifer, usually named something meaningful, like 'sales' or 'inventory'."/>
        <column name="processing_order" type="INTEGER" required="true" default="1" description="Order of sequence to process channel data."/>
        <column name="max_batch_size" type="INTEGER" required="true" default="1000" description="The maximum number of Data Events to process within a batch for this channel."/>
        <column name="max_batch_to_send" type="INTEGER" required="true" default="60" description="The maximum number of batches to send during a synchronization between two nodes. " />
        <column name="extract_period_millis" type="INTEGER" required="true" default="0" description="The minimum number of milliseconds allowed between attempts to extract data for targeted at a node_id."/>
        <column name="enabled" type="BOOLEANINT" size="1" required="true" default="1" description="Indicates whether channel is enabled or not."/>
        <column name="batch_algorithm" type="VARCHAR" size="50" required="true" default="default" description="The algorithm to use when batching data on this channel.  Possible values are: 'default', 'transactional', and 'nontransactional'"/>
        <column name="description" type="VARCHAR" size="1000" description="Description on the type of data carried in this channel."/>
    </table>

    <table name="node_group" description="A category of Nodes that synchronizes data with one or more NodeGroups. A common use of NodeGroup is to describe a level in a hierarchy of data synchronization.">
        <column name="node_group_id" type="VARCHAR" size="50" required="true" primaryKey="true" description="Unique identifier for a node group, usually named something meaningful, like 'store' or 'warehouse'."/>
        <column name="description" type="VARCHAR" size="1000" description="A description of this node group."/>
    </table>

    <table name="node_group_link" description="A source node_group sends its data updates to a target NodeGroup using a pull, push, or custom technique.">
        <column name="source_node_group_id" type="VARCHAR" size="50" required="true" primaryKey="true" description="The node group where data changes should be captured." />
        <column name="target_node_group_id" type="VARCHAR" size="50" required="true" primaryKey="true" description="The node group where data changes will be sent." />
        <column name="data_event_action" type="CHAR" size="1" default="W" required="true" description="The notification scheme used to send data changes to the target node group. (P = Push, W = Wait for Pull) " />
    </table>

    <table name="node_group_channel_window" description="An optional window of time for which a node group and channel will be active. ">
        <column name="node_group_id" type="VARCHAR" size="50" required="true" primaryKey="true" description="The node_group_id that this window applies to."/>
        <column name="channel_id" type="VARCHAR" size="20" required="true" primaryKey="true"  description="The channel_id that this window applies to."/>
        <column name="start_time" type="TIME" required="true" primaryKey="true"  description="The start time for the active window."/>
        <column name="end_time" type="TIME" required="true" primaryKey="true" description="The end time for the active window.  Note that if the end_time is less than the start_time then the window crosses a day boundary."/>
        <column name="enabled" type="BOOLEANINT" size="1" required="true" default="0" description="Enable this window.  If this is set to '0' then this window is ignored."/>
    </table>

    <table name="node" description="Representation of an instance of SymmetricDS that synchronizes data with one or more additional nodes. Each node has a unique identifier (nodeId) that is used when communicating, as well as a domain-specific identifier (externalId) that provides context within the local system.">
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true" description="A unique identifier for a node." />
        <column name="node_group_id" type="VARCHAR" size="50" required="true" description="The node group that this node belongs to, such as 'store'." />
        <column name="external_id" type="VARCHAR" size="50" required="true" description="A domain-specific identifier for context within the local system. For example, the retail store number. "/>
        <column name="sync_enabled" type="BOOLEANINT" size="1" default="0" description="Indicates whether this node should be sent synchronization. Disabled nodes are ignored by the triggers, so no entries are made in data_event for the node."/>
        <column name="sync_url" type="VARCHAR" size="2000" description="The URL to contact the node for synchronization." />
        <column name="schema_version" type="VARCHAR" size="50" description="The version of the database schema this node manages. Useful for specifying synchronization by version. "/>
        <column name="symmetric_version" type="VARCHAR" size="50"  description="The version of SymmetricDS running at this node." />
        <column name="database_type" type="VARCHAR" size="50"  description="The database product name at this node as reported by JDBC."  />
        <column name="database_version" type="VARCHAR" size="50"  description="The database product version at this node as reported by JDBC." />
        <column name="heartbeat_time" type="TIMESTAMP"  description="The last timestamp when the node sent a heartbeat, which is attempted every ten minutes by default." />
        <column name="timezone_offset" type="VARCHAR" size="6"  description="The timezone offset in RFC822 format at the time of the last heartbeat. " />
        <column name="created_at_node_id" type="VARCHAR" size="50"  description="The node_id of the node where this node was created. This is typically filled automatically with the node_id found in node_identity where registration was opened for the node. " />
    </table>

    <table name="node_security" description="Security features like node passwords and open registration flag are stored in the node_security table. ">
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true"  description="Unique identifier for a node." />
        <column name="node_password" type="VARCHAR" size="50" required="true"  description="The password used by the node to prove its identity during synchronization." />
        <column name="registration_enabled" type="BOOLEANINT" size="1" default="0"  description="Indicates whether registration is open for this node.  Re-registration may be forced for a node if this is set back to '1' in a parent database for the node_id that should be re-registred." />
        <column name="registration_time" type="TIMESTAMP" required="false"  description="The timestamp when this node was last registered." />
        <column name="initial_load_enabled" type="BOOLEANINT" size="1" default="0"  description="Indicates whether an initial load will be sent to this node." />
        <column name="initial_load_time" type="TIMESTAMP" required="false"  description="The timestamp when this node started the initial load." />
        <column name="created_at_node_id" type="VARCHAR" size="50" required="true"  description="The node_id of the node where this node was created. This is typically filled automatically with the node_id found in node_identity where registration was opened for the node. " />
    </table>

    <table name="node_identity" description="After registration, this table will have one row representing the identity of the node. For a root node, the row is entered by the user.">
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true"  description="Unique identifier for a node." />
    </table>

    <table name="node_channel_ctl" description="Used to ignore or suspend a channel. A channel that is ignored will have its data_events batched and they will immediately be marked as 'OK' without sending them. A channel that is suspended is skipped when batching data_events.">
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true"  description="Unique identifier for a node." />
        <column name="channel_id" type="VARCHAR" size="20" required="true" primaryKey="true"  description="The name of the channel_id that is being controlled." />
        <column name="suspend_enabled" type="BOOLEANINT" size="1" default="0"  description="Indicates if this channel is suspended, which prevents its Data Events from being batched." />
        <column name="ignore_enabled" type="BOOLEANINT" size="1" default="0"  description="Indicates if this channel is ignored, which marks its Data Events as if they were actually processed." />
        <column name="last_extract_time" type="TIMESTAMP"  description="Record the last time data was extract for a node and a channel." />
    </table>

    <table name="registration_redirect" description="" >
        <column name="registrant_external_id" type="VARCHAR" size="50" required="true" primaryKey="true"  description="" />
        <column name="registration_node_id" type="VARCHAR" size="50" required="true"  description="" />
    </table>

    <table name="router">
        <column name="router_id" type="VARCHAR" size="20" required="true" primaryKey="true"  description="" />
        <column name="target_catalog_name" type="VARCHAR" size="50"  description="" />
        <column name="target_schema_name" type="VARCHAR" size="50"  description="" />
        <column name="target_table_name" type="VARCHAR" size="50"  description="" />
        <column name="source_node_group_id" type="VARCHAR" size="50" required="true"  description="" />
        <column name="target_node_group_id" type="VARCHAR" size="50" required="true"  description="" />
        <column name="router_name" type="VARCHAR" size="50"  description="" />
        <column name="router_expression" type="CLOB"  description="" />
        <column name="sync_on_update" type="BOOLEANINT" size="1" required="true" default="1"  description="" />
        <column name="sync_on_insert" type="BOOLEANINT" size="1" required="true" default="1"  description="" />
        <column name="sync_on_delete" type="BOOLEANINT" size="1" required="true" default="1"  description="" />
        <column name="initial_load_select" type="CLOB"  description="" />
        <column name="create_time" type="TIMESTAMP" required="true"  description="" />
        <column name="last_update_by" type="VARCHAR" size="50"  description="" />
        <column name="last_update_time" type="TIMESTAMP" required="true"  description="" />
    </table>

    <table name="trigger">
        <column name="trigger_id" type="VARCHAR" size="20" required="true" primaryKey="true"  description="" />
        <column name="source_catalog_name" type="VARCHAR" size="50"  description="" />
        <column name="source_schema_name" type="VARCHAR" size="50"  description="" />
        <column name="source_table_name" type="VARCHAR" size="50" required="true"  description="" />
        <column name="channel_id" type="VARCHAR" size="20" required="true"  description="" />
        <column name="sync_on_update" type="BOOLEANINT" size="1" required="true" default="1"  description="" />
        <column name="sync_on_insert" type="BOOLEANINT" size="1" required="true" default="1"  description="" />
        <column name="sync_on_delete" type="BOOLEANINT" size="1" required="true" default="1"  description="" />
        <column name="sync_on_incoming_batch" type="BOOLEANINT" size="1" required="true" default="0"  description="" />
        <column name="name_for_update_trigger" type="VARCHAR" size="50"  description="" />
        <column name="name_for_insert_trigger" type="VARCHAR" size="50"  description="" />
        <column name="name_for_delete_trigger" type="VARCHAR" size="50"  description="" />
        <column name="sync_on_update_condition" type="CLOB"  description="" />
        <column name="sync_on_insert_condition" type="CLOB"  description="" />
        <column name="sync_on_delete_condition" type="CLOB"  description="" />
        <column name="tx_id_expression" type="VARCHAR" size="500"  description="" />
        <column name="excluded_column_names" type="CLOB"  description="" />
        <column name="create_time" type="TIMESTAMP" required="true"  description="" />
        <column name="inactive_time" type="TIMESTAMP"  description="" />
        <column name="last_update_by" type="VARCHAR" size="50"  description="" />
        <column name="last_update_time" type="TIMESTAMP" required="true"  description="" />
    </table>

    <table name="trigger_router">
        <column name="trigger_id" type="VARCHAR" size="20" required="true" primaryKey="true"  description="" />
        <column name="router_id" type="VARCHAR" size="20" required="true" primaryKey="true"  description="" />
        <column name="initial_load_order" type="INTEGER" required="true" default="1"  description="" />
        <column name="create_time" type="TIMESTAMP" required="true"  description="" />
        <column name="last_update_by" type="VARCHAR" size="50"  description="" />
        <column name="last_update_time" type="TIMESTAMP" required="true"  description="" />
    </table>

    <table name="trigger_hist">
        <column name="trigger_hist_id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"  description="" />
        <column name="trigger_id" type="VARCHAR" size="20" required="true"  description="" />
        <column name="source_table_name" type="VARCHAR" default="" size="50" required="true"  description="" />
        <column name="source_catalog_name" type="VARCHAR" size="50"  description="" />
        <column name="source_schema_name" type="VARCHAR" size="50"  description="" />
        <column name="name_for_update_trigger" type="VARCHAR" size="50" required="true"  description="" />
        <column name="name_for_insert_trigger" type="VARCHAR" size="50" required="true"  description="" />
        <column name="name_for_delete_trigger" type="VARCHAR" size="50" required="true"  description="" />
        <column name="table_hash" type="BIGINT" required="true"  description="" />
        <column name="trigger_row_hash" type="BIGINT" required="true"  description="" />
        <column name="column_names" type="LONGVARCHAR" required="true"  description="" />
        <column name="pk_column_names" type="LONGVARCHAR" required="true"  description="" />
        <column name="last_trigger_build_reason" size="1" type="CHAR" required="true"  description="" />
        <column name="create_time" type="TIMESTAMP" required="true"  description="" />
        <column name="inactive_time" type="TIMESTAMP"  description="" />
    </table>

    <table name="data">
        <column name="data_id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"  description="" />
        <column name="table_name" type="VARCHAR" size="50" required="true"  description="" />
        <column name="event_type" type="CHAR" size="1" required="true"  description="" />
        <column name="row_data" type="LONGVARCHAR"  description="" />
        <column name="pk_data" type="LONGVARCHAR"  description="" />
        <column name="old_data" type="LONGVARCHAR"  description="" />
        <column name="trigger_hist_id" type="INTEGER" required="true"  description="" />
        <column name="channel_id" type="VARCHAR" size="20"  description="" />
        <column name="transaction_id" type="VARCHAR" size="1000"  description="" />
        <column name="source_node_id" type="VARCHAR" size="50"  description="" />
        <column name="create_time" type="TIMESTAMP"  description="" />
    </table>

    <table name="data_event">
        <column name="data_id" type="INTEGER" required="true" primaryKey="true"  description="" />
        <column name="batch_id" type="INTEGER" required="true" primaryKey="true" default="-1"  description="" />
        <column name="router_id" type="VARCHAR" size="20" required="true"  primaryKey="true"  description="" />
        <column name="create_time" type="TIMESTAMP"  description="" />
        <index name="idx_de_batchid">
            <index-column name="batch_id"/>
        </index>
    </table>

    <table name="data_ref">
        <column name="ref_data_id" type="INTEGER" required="true" primaryKey="true"  description="" />
        <column name="ref_time" type="TIMESTAMP"  description="" />
    </table>

    <table name="outgoing_batch">
        <column name="batch_id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"  description="" />
        <column name="node_id" type="VARCHAR" size="50"  description="" />
        <column name="channel_id" type="VARCHAR" size="20"  description="" />
        <column name="status" type="CHAR" size="2"  description="" />
        <column name="byte_count" type="INTEGER"  description="" />
        <column name="sent_count" type="INTEGER"  description="" />
        <column name="data_event_count" type="INTEGER"  description="" />
        <column name="router_millis" type="INTEGER"  description="" />
        <column name="network_millis" type="INTEGER"  description="" />
        <column name="filter_millis" type="INTEGER"  description="" />
        <column name="load_millis" type="INTEGER"  description="" />
        <column name="extract_millis" type="INTEGER"  description="" />
        <column name="sql_state" type="VARCHAR" size="10"  description="" />
        <column name="sql_code" type="INTEGER"  description="" />
        <column name="sql_message" type="VARCHAR" size="1000"  description="" />
        <column name="failed_data_id" type="INTEGER"  description="" />
        <column name="last_update_hostname" type="VARCHAR" size="50"  description="" />
        <column name="last_update_time" type="TIMESTAMP"  description="" />
        <column name="create_time" type="TIMESTAMP"  description="" />
    </table>

    <table name="incoming_batch">
        <column name="batch_id" type="INTEGER" size="50" required="true" primaryKey="true"  description="" />
        <column name="node_id" type="VARCHAR" size="50" required="true" primaryKey="true"  description="" />
        <column name="channel_id" type="VARCHAR" size="20"  description="" />
        <column name="status" type="CHAR" size="2"  description="" />
        <column name="network_millis" type="INTEGER"  description="" />
        <column name="filter_millis" type="INTEGER"  description="" />
        <column name="database_millis" type="INTEGER"  description="" />
        <column name="failed_row_number" type="INTEGER"  description="" />
        <column name="byte_count" type="INTEGER"  description="" />
        <column name="statement_count" type="INTEGER"  description="" />
        <column name="fallback_insert_count" type="INTEGER"  description="" />
        <column name="fallback_update_count" type="INTEGER"  description="" />
        <column name="missing_delete_count" type="INTEGER"  description="" />
        <column name="skip_count" type="INTEGER"  description="" />
        <column name="sql_state" type="VARCHAR" size="10"  description="" />
        <column name="sql_code" type="INTEGER"  description="" />
        <column name="sql_message" type="VARCHAR" size="1000"  description="" />
        <column name="last_update_hostname" type="VARCHAR" size="50"  description="" />
        <column name="last_update_time" type="TIMESTAMP"  description="" />
        <column name="create_time" type="TIMESTAMP"  description="" />
    </table>

    <table name="statistic">
        <column name="node_id" type="VARCHAR" size="50"  description="" />
        <column name="host_name" type="VARCHAR" size="50"  description="" />
        <column name="statistic_name" type="VARCHAR" size="50"  description="" />
        <column name="statistic_total" type="DECIMAL" size="20"  description="" />
        <column name="statistic_count" type="BIGINT"  description="" />
        <column name="capture_start_time" type="TIMESTAMP"  description="" />
        <column name="capture_end_time" type="TIMESTAMP"  description="" />
        <index name="idx_stat">
            <index-column name="node_id"/>
            <index-column name="statistic_name"/>
        </index>
        <index name="idx_stat_end_time">
            <index-column name="capture_end_time"/>
        </index>
    </table>

    <!-- This table configures thresholds at which JMX notifications will be fired-->
    <table name="statistic_alert">
        <column name="statistic_name" type="VARCHAR" size="50" required="true" primaryKey="true"  description="" />
        <column name="threshold_total_max" type="DECIMAL" size="20"  description="" />
        <column name="threshold_avg_max" type="DECIMAL" size="20"  description="" />
        <column name="threshold_count_max" type="BIGINT"  description="" />
        <column name="threshold_total_min" type="DECIMAL" size="20"  description="" />
        <column name="threshold_count_min" type="BIGINT"  description="" />
        <column name="threshold_avg_min" type="DECIMAL" size="20"  description="" />
    </table>

</database>